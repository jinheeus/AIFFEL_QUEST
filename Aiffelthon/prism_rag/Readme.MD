# ğŸ”® PRISM - RAG ì±—ë´‡ ì—°ê²° ê°€ì´ë“œ

> **PRISM** (Public Risk Intelligence & Smart Management)  
> ê³µê³µ ê°ì‚¬ ë°ì´í„°ë¥¼ ë‹¤ì°¨ì›ìœ¼ë¡œ ë¶„ì„í•˜ëŠ” AI ê°ì‚¬ ë¶„ì„ ì‹œìŠ¤í…œ

---

## ğŸ“ ê¹ƒí—ˆë¸Œì— ì˜¬ë ¤ì•¼ í•˜ëŠ” íŒŒì¼ ëª©ë¡

```
prism_rag/
â”‚
â”œâ”€â”€ README.MD                                   âœ… ì´ íŒŒì¼
â”œâ”€â”€ requirements.txt                            âœ… íŒ¨í‚¤ì§€ ëª©ë¡
â”œâ”€â”€ upload_to_milvus.py                         âœ… Milvus ì—…ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ docker-compose.yml                          âœ… Milvus Docker ì„¤ì •
â”‚
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ config.py                               âœ… ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ model_factory.py                        âœ… ëª¨ë¸ ì´ˆê¸°í™”
â”‚   â”œâ”€â”€ logger_config.py                        âœ… ë¡œê±° ì„¤ì •
â”‚   â””â”€â”€ memory/
â”‚       â””â”€â”€ redis_checkpointer.py               âœ… Redis ì²´í¬í¬ì¸í„°
â”‚
â”œâ”€â”€ rag/
â”‚   â””â”€â”€ agentic_rag_v2/
â”‚       â”œâ”€â”€ graph.py                            âœ… RAG ê·¸ë˜í”„
â”‚       â”œâ”€â”€ state.py                            âœ… ìƒíƒœ ì •ì˜
â”‚       â””â”€â”€ modules/
â”‚           â”œâ”€â”€ vector_retriever.py             âœ… Milvus + BM25 ê²€ìƒ‰
â”‚           â”œâ”€â”€ generator.py                    âœ… ë‹µë³€ ìƒì„± (PRISM í”„ë¡¬í”„íŠ¸)
â”‚           â”œâ”€â”€ retriever.py                    âœ… ê²€ìƒ‰ ë˜í¼
â”‚           â”œâ”€â”€ grader.py                       âœ… ë¬¸ì„œ í‰ê°€
â”‚           â”œâ”€â”€ rewriter.py                     âœ… ì¿¼ë¦¬ ì¬ì‘ì„±
â”‚           â”œâ”€â”€ field_selector.py               âœ… í•„ë“œ ì„ íƒ
â”‚           â”œâ”€â”€ sop_retriever.py                âœ… SOP ê²€ìƒ‰
â”‚           â”œâ”€â”€ memory.py                       âœ… ëŒ€í™” ìš”ì•½
â”‚           â”œâ”€â”€ sql_retriever.py                âœ… SQL ê²€ìƒ‰
â”‚           â”œâ”€â”€ drafting_agent.py               âœ… ë³´ê³ ì„œ ì‘ì„± ì—ì´ì „íŠ¸
â”‚           â””â”€â”€ chat_worker.py                  âœ… ì¼ìƒ ëŒ€í™” ì²˜ë¦¬
â”‚
â””â”€â”€ web_app/
    â”œâ”€â”€ backend/
    â”‚   â””â”€â”€ main.py                             âœ… FastAPI ë°±ì—”ë“œ
    â””â”€â”€ frontend/
        â””â”€â”€ app.py                              âœ… Streamlit ëŒ€ì‹œë³´ë“œ
```

---

## ğŸš« ê¹ƒí—ˆë¸Œì— ì˜¬ë¦¬ë©´ ì•ˆ ë˜ëŠ” íŒŒì¼

```
â”œâ”€â”€ audit_v10.json              âŒ ìš©ëŸ‰ í¼ â†’ ë³„ë„ ê³µìœ  (êµ¬ê¸€ë“œë¼ì´ë¸Œ ë“±)
â”œâ”€â”€ .env                        âŒ API í‚¤ í¬í•¨ â†’ ì ˆëŒ€ ì˜¬ë¦¬ë©´ ì•ˆ ë¨
â”œâ”€â”€ venv_aura/                  âŒ ê°€ìƒí™˜ê²½ í´ë”
â”œâ”€â”€ volumes/                    âŒ Milvus Docker ë°ì´í„°
â”œâ”€â”€ __pycache__/                âŒ íŒŒì´ì¬ ìºì‹œ
â””â”€â”€ bm25_cache.pkl              âŒ BM25 ìºì‹œ (ìë™ ìƒì„±ë¨)
```

---

## ğŸ™ ê¹ƒí—ˆë¸Œ ì—…ë¡œë“œ ë°©ë²• (ë¦¬ë”ê°€ í•  ë‚´ìš©)

### Step 1. íŒ€ì› ì´ˆëŒ€

1. [github.com/jinheeus/AIFFEL_QUEST](https://github.com/jinheeus/AIFFEL_QUEST) ì ‘ì†
2. **Settings** â†’ **Collaborators** í´ë¦­
3. **Add people** í´ë¦­
4. íŒ€ì› ê¹ƒí—ˆë¸Œ ìœ ì €ë„¤ì„ ì…ë ¥ í›„ ì´ˆëŒ€
5. íŒ€ì›ì€ ì´ë©”ì¼ ë˜ëŠ” ê¹ƒí—ˆë¸Œ ì•Œë¦¼ì—ì„œ ì´ˆëŒ€ ìˆ˜ë½

---

### Step 2. .gitignore ë§Œë“¤ê¸°

```bash
cd ~/projects/prism_rag

cat > .gitignore << 'EOF'
venv_aura/
.env
audit_v10.json
volumes/
__pycache__/
*.pyc
bm25_cache.pkl
*.log
nohup.out
web_app/frontend/node_modules/
web_app/frontend/.next/
.vscode/
EOF
```

---

### Step 3. ê¹ƒí—ˆë¸Œ ê³„ì • ì„¤ì •

```bash
git config --global user.email "wltn021212@gmail.com"
git config --global user.name "JISU"
```

> ê¹ƒí—ˆë¸Œ ì´ë©”ì¼/ìœ ì €ë„¤ì„ í™•ì¸: github.com â†’ í”„ë¡œí•„ â†’ Settings â†’ Emails

---

### Step 4. íŒŒì¼ ì¶”ê°€ ë° ì»¤ë°‹

```bash
git add .

# audit_v10.json ì—†ëŠ”ì§€ ê¼­ í™•ì¸!
git status

git commit -m "feat: PRISM RAG ì±—ë´‡ ì„¸íŒ…"
```

---

### Step 5. ê¹ƒí—ˆë¸Œì— ì—…ë¡œë“œ

```bash
git push origin main
```

---

### Step 6. ë°ì´í„°ì…‹ ë³„ë„ ê³µìœ 

`audit_v10.json`ì€ ìš©ëŸ‰ì´ í¬ë¯€ë¡œ **êµ¬ê¸€ë“œë¼ì´ë¸Œ**ë¡œ íŒ€ì›ì—ê²Œ ë³„ë„ ê³µìœ í•˜ì„¸ìš”.

---

## ğŸ‘¥ íŒ€ì› ì—°ê²° ë°©ë²• (íŒ€ì›ì´ ë”°ë¼í•  ë‚´ìš©)

### Step 1. ì´ˆëŒ€ ìˆ˜ë½

- ê¹ƒí—ˆë¸Œ ì´ë©”ì¼ì—ì„œ `Accept invitation` í´ë¦­
- ë˜ëŠ” `https://github.com/jinheeus/AIFFEL_QUEST/invitations` ì ‘ì†í•´ì„œ ìˆ˜ë½

### Step 2. ë ˆí¬ í´ë¡ 

```bash
git clone https://github.com/jinheeus/AIFFEL_QUEST.git
cd AIFFEL_QUEST/Aiffelthon
```

### Step 3. ê°€ìƒí™˜ê²½ ì„¤ì •

```bash
python -m venv venv_aura

# Mac/Linux
source venv_aura/bin/activate

# Windows
venv_aura\Scripts\activate

pip install -r requirements.txt
```

### Step 4. API í‚¤ ì„¤ì •

íŒ€ ë¦¬ë”ì—ê²Œ API í‚¤ë¥¼ ë°›ì•„ì„œ `common/config.py`ì— ì…ë ¥:

```python
CLOVA_API_KEY = "ë°›ì€ API í‚¤ ì…ë ¥"
```

### Step 5. ë°ì´í„°ì…‹ ë°›ê¸°

íŒ€ ë¦¬ë”ì—ê²Œ ë°›ì€ `audit_v10.json`ì„ í”„ë¡œì íŠ¸ í´ë”ì— ë„£ê¸°:
```
AIFFEL_QUEST/Aiffelthon/audit_v10.json  â† ì—¬ê¸°ì—!
```

### Step 6. Dockerë¡œ Milvus ì‹¤í–‰

```bash
docker-compose up -d
```

í™•ì¸:
```bash
docker ps
# milvus-standalone, milvus-etcd, milvus-minio 3ê°œê°€ Up ìƒíƒœì—¬ì•¼ í•´ìš”
```

### Step 7. Milvus ë°ì´í„° ì—…ë¡œë“œ (ìµœì´ˆ 1íšŒë§Œ)

```bash
python upload_to_milvus.py
```

ì™„ë£Œ ë©”ì‹œì§€:
```
âœ… ì—…ë¡œë“œ ì™„ë£Œ!
row_count: 8000+
```

### Step 8. ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰

```bash
python web_app/backend/main.py
```

ì •ìƒ ì‹¤í–‰:
```
âœ… BM25 Index Ready with XXXXX docs.
ğŸ”¹ [Startup] VectorRetriever Ready!
INFO: Uvicorn running on http://0.0.0.0:8000
```

### Step 9. Streamlit ëŒ€ì‹œë³´ë“œ ì‹¤í–‰

ìƒˆ í„°ë¯¸ë„ì„ ì—´ê³ :
```bash
source venv_aura/bin/activate
streamlit run web_app/frontend/app.py
```

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8501` ì ‘ì† â†’ **Section 3. AI ë¶„ì„** ì—ì„œ í…ŒìŠ¤íŠ¸!

---

## ğŸ§ª ì—°ê²° í™•ì¸ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸

```
2024ë…„ ì„±ì‹¤ì˜ë¬´ ìœ„ë°˜ìœ¼ë¡œ ì§•ê³„ë°›ì€ ì‚¬ë¡€ ì•Œë ¤ì¤˜
```

ì •ìƒ ì‘ë‹µì´ ì˜¤ë©´ ì—°ê²° ì™„ë£Œ! âœ…

---

## â— ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜

| ì˜¤ë¥˜ | ì›ì¸ | í•´ê²° |
|------|------|------|
| `MilvusException: Fail connecting to server` | Docker êº¼ì§ | `docker-compose up -d` ì¬ì‹¤í–‰ |
| `[Errno 98] address already in use` | í¬íŠ¸ 8000 ì¶©ëŒ | `kill $(lsof -t -i:8000)` í›„ ì¬ì‹œì‘ |
| `Failed to load corpus` | BM25 ìºì‹œ ì˜¤ë¥˜ | `rm rag/agentic_rag_v2/modules/bm25_cache.pkl` í›„ ì¬ì‹œì‘ |
| `âš ï¸ Redis connection failed` | Redis ë¯¸ì„¤ì¹˜ | ë¬´ì‹œ ê°€ëŠ¥ (In-Memoryë¡œ ìë™ ì „í™˜) |
| `audit_v10.json not found` | ë°ì´í„°ì…‹ ì—†ìŒ | íŒ€ ë¦¬ë”ì—ê²Œ íŒŒì¼ ìš”ì²­ |

---

## ğŸ“Œ ì‹œìŠ¤í…œ ì •ë³´

| í•­ëª© | ê°’ |
|------|-----|
| ë°±ì—”ë“œ í¬íŠ¸ | 8000 |
| í”„ë¡ íŠ¸ì—”ë“œ í¬íŠ¸ | 8501 |
| Milvus í¬íŠ¸ | 19530 |
| ì»¬ë ‰ì…˜ëª… | audit_v10_collection |
| ë°ì´í„°ì…‹ | audit_v10.json (5043ê°œ) |
| RAG ëª¨ë“ˆ | agentic_rag_v2 |

---